<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<link rel="search" type="application/opensearchdescription+xml" title="FlutterFire" href="/opensearch.xml">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#0175c2"><title data-react-helmet="true">Cloud Firestore | FlutterFire</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Cloud Firestore | FlutterFire"><meta data-react-helmet="true" name="description" content="To start using the Cloud Firestore package within your project, import it at the top of your project files:"><meta data-react-helmet="true" property="og:description" content="To start using the Cloud Firestore package within your project, import it at the top of your project files:"><meta data-react-helmet="true" property="og:url" content="https://firebase.flutter.dev/docs/firestore/usage"><link data-react-helmet="true" rel="shortcut icon" href="/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://firebase.flutter.dev/docs/firestore/usage"><link rel="stylesheet" href="/styles.da17c98e.css">
<link rel="stylesheet" href="/main.4ce985a5.css">
<link rel="stylesheet" href="/1be78505.7cbeb736.css">
<link rel="preload" href="/styles.c98d0ca8.js" as="script">
<link rel="preload" href="/runtime~main.5b92252b.js" as="script">
<link rel="preload" href="/main.0718b78d.js" as="script">
<link rel="preload" href="/1.37d6b62d.js" as="script">
<link rel="preload" href="/2.33792e98.js" as="script">
<link rel="preload" href="/1be78505.7a3fab9e.js" as="script">
<link rel="preload" href="/44.07295e31.js" as="script">
<link rel="preload" href="/46.c746ba4f.js" as="script">
<link rel="preload" href="/20ac7829.8ec54cef.js" as="script">
<link rel="preload" href="/4ef789ca.1eae9852.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/flutterfire_300x.png" alt="FlutterFire Logo"><strong class="navbar__title">FlutterFire</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview">Docs</a><a href="https://twitter.com/flutterfiredev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><a href="https://github.com/firebaseextended/flutterfire" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/flutterfire_300x.png" alt="FlutterFire Logo"><strong class="navbar__title">FlutterFire</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a href="https://twitter.com/flutterfiredev" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li><li class="menu__list-item"><a href="https://github.com/firebaseextended/flutterfire" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/android">Android Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/ios">iOS Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/web">Web Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Analytics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/analytics/overview">Overview</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_analytics/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_analytics/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Authentication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/auth/overview">Overview</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_auth/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_auth/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Cloud Firestore</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firestore/overview">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/firestore/usage">Usage</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/cloud_firestore/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/cloud_firestore/latest/" tabindex="0">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Functions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/functions/overview">Overview</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/cloud_functions/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/cloud_functions/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Storage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/storage/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/storage/usage">Usage</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_storage/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_storage/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Core</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/core/usage">Usage</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_core/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_core/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Realtime Database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/database/overview">Overview</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_database/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_database/latest/" tabindex="-1">Reference API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/overview">Overview</a></li><li class="menu__list-item"><a href="https://pub.dev/documentation/firebase_performance/latest/" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://pub.dev/documentation/firebase_performance/latest/" tabindex="-1">Reference API</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Cloud Firestore</h1></header><div class="markdown"><p>To start using the Cloud Firestore package within your project, import it at the top of your project files:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:cloud_firestore/cloud_firestore.dart&#x27;;</span></div></div></div></div></div><p>Before using Firestore, you must first have ensured you have <a href="/docs/firestore/overview#initializing-flutterfire">initialized FlutterFire</a>.</p><p>To create a new Firestore instance, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/instance.html" target="_blank"><code>instance</code></a> getter on <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore-class.html" target="_blank"><code>FirebaseFirestore</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore firestore = FirebaseFirestore.instance;</span></div></div></div></div></div><p>By default, this allows you to interact with Firestore using the default Firebase App used whilst installing FlutterFire on your
platform. If however you&#x27;d like to use Firestore with a secondary Firebase App, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/instanceFor.html" target="_blank"><code>instanceFor</code></a> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseApp secondaryApp = Firebase.app(&#x27;SecondayApp&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore firestore = FirebaseFirestore.instanceFor(app: secondaryApp);</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="collections--documents"></a>Collections &amp; Documents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#collections--documents" title="Direct link to heading">#</a></h2><p>Firestore stores data within &quot;documents&quot;, which are contained within &quot;collections&quot;. Documents can also contain
nested collections. For example, our users would each have their own &quot;document&quot; stored inside the &quot;Users&quot; collection.
The <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/collection.html" target="_blank"><code>collection</code></a> method allows us to reference a collection within our code.</p><p>In the below example, we can reference the collection <code>users</code>, and create a new user document when a button is pressed:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:flutter/material.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Import the firebase_core and cloud_firestore plugin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:firebase_core/firebase_core.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:cloud_firestore/cloud_firestore.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class AddUser extends StatelessWidget {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final String fullName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final String company;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final int age;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  AddUser(this.fullName, this.company, this.age);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Widget build(BuildContext context) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create a CollectionReference called users that references the firestore collection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Future&lt;void&gt; addUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // Call the users CollectionReference to add a new user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .add({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;full_name&#x27;: fullName, // John Doe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;company&#x27;: company, // Stokes and Sons</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;age&#x27;: age // 42</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .then((value) =&gt; print(&quot;User Added&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .catchError((error) =&gt; print(&quot;Failed to add user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return FlatButton(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      onPressed: addUser,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      child: Text(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;Add User&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="read-data"></a>Read Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#read-data" title="Direct link to heading">#</a></h2><p>Cloud Firestore gives you the ability to read the value of a collection or a document. This can be a one-time read, or
provided by realtime updates when the data within a query changes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="one-time-read"></a>One-time Read<a aria-hidden="true" tabindex="-1" class="hash-link" href="#one-time-read" title="Direct link to heading">#</a></h3><p>To read a collection or document once, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/Query/get.html" target="_blank"><code>Query.get</code></a> or <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/get.html" target="_blank"><code>DocumentReference.get</code></a> methods.
In the below example a <a href="https://api.flutter.dev/flutter/widgets/FutureBuilder-class.html"><code>FutureBuilder</code></a> is used to help manage the state
of the request:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class GetUserName extends StatelessWidget {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final String documentId;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  GetUserName(this.documentId);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Widget build(BuildContext context) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return FutureBuilder&lt;DocumentSnapshot&gt;(</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      future: users.doc(documentId).get(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      builder:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          (BuildContext context, AsyncSnapshot&lt;DocumentSnapshot&gt; snapshot) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (snapshot.hasError) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return Text(&quot;Something went wrong&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (snapshot.connectionState == ConnectionState.done) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Map&lt;String, dynamic&gt; data = snapshot.data();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return Text(&quot;Full Name: ${data[&#x27;full_name&#x27;]} ${data[&#x27;last_name&#x27;]}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return Text(&quot;loading&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>To learn more about reading data whilst offline, view the <a href="#access-data-offline">Access Data Offline</a> documentation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="realtime-changes"></a>Realtime changes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#realtime-changes" title="Direct link to heading">#</a></h3><p>FlutterFire provides support for dealing with realtime changes to collections and documents. A new event is provided
on the initial request, and any subsequent changes to collection/document whenever a change occurs (modification, deleted
or added).</p><p>Both the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/CollectionReference-class.html" target="_blank"><code>CollectionReference</code></a> &amp; <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference-class.html" target="_blank"><code>DocumentReference</code></a> provide
a <code>snapshots()</code> method which returns a <a href="https://api.dart.dev/stable/2.8.3/dart-async/Stream-class.html"><code>Stream</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stream collectionStream = FirebaseFirestore.instance.collection(&#x27;users&#x27;).snapshots();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stream documentStream = FirebaseFirestore.instance.collection(&#x27;users&#x27;).doc(&#x27;ABC123&#x27;).snapshots();</span></div></div></div></div></div><p>Once returned, you can subscribe to updates via the <code>listen()</code> method. The below example uses a <a href="https://api.flutter.dev/flutter/widgets/StreamBuilder-class.html"><code>StreamBuilder</code></a>
which helps automatically manage the streams state and disposal of the stream when it&#x27;s no longer used within your app:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class UserInformation extends StatelessWidget {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Widget build(BuildContext context) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return StreamBuilder&lt;QuerySnapshot&gt;(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      stream: users.snapshots(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      builder: (BuildContext context, AsyncSnapshot&lt;QuerySnapshot&gt; snapshot) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (snapshot.hasError) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return Text(&#x27;Something went wrong&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (snapshot.connectionState == ConnectionState.waiting) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return Text(&quot;Loading&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new ListView(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          children: snapshot.data.documents.map((DocumentSnapshot document) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return new ListTile(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              title: new Text(document.data()[&#x27;full_name&#x27;]),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              subtitle: new Text(document.data()[&#x27;company&#x27;]),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }).toList(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>By default, listeners do not update if there is a change that only affects the metadata. If you want to receive events
when the document or query metadata changes, you can pass <code>includeMetadataChanges</code> to the <code>snapshots</code> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .snapshots(includeMetadataChanges: true)</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="document--query-snapshots"></a>Document &amp; Query Snapshots<a aria-hidden="true" tabindex="-1" class="hash-link" href="#document--query-snapshots" title="Direct link to heading">#</a></h3><p>When perfoming a query, Firestore returns either a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/QuerySnapshot-class.html" target="_blank"><code>QuerySnapshot</code></a> or a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot-class.html" target="_blank"><code>DocumentSnapshot</code></a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="querysnapshot"></a>QuerySnapshot<a aria-hidden="true" tabindex="-1" class="hash-link" href="#querysnapshot" title="Direct link to heading">#</a></h4><p>A <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/QuerySnapshot-class.html" target="_blank"><code>QuerySnapshot</code></a> is returned from a collection query, and allows you to inspect the collection, such as how many documents
exist within it, gives access to the documents within the collection, see any changes since the last query and more.</p><p>To access the documents within a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/QuerySnapshot-class.html" target="_blank"><code>QuerySnapshot</code></a>, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/QuerySnapshot/docs.html" target="_blank"><code>docs</code></a> property,
which returns a <code>List</code> containing <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot-class.html" target="_blank"><code>DocumentSnapshot</code></a> classes.</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((QuerySnapshot querySnapshot) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        querySnapshot.docs.forEach((doc) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            print(doc[&quot;first_name&quot;]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="documentsnapshot"></a>DocumentSnapshot<a aria-hidden="true" tabindex="-1" class="hash-link" href="#documentsnapshot" title="Direct link to heading">#</a></h4><p>A <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot-class.html" target="_blank"><code>DocumentSnapshot</code></a> is returned from a query, or by accessing the
document directly. Even if no document exists in the database, a snapshot will always be returned.</p><p>To determine whether the document exists, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot/exists.html" target="_blank"><code>exists</code></a> property:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .document(userId)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((DocumentSnapshot documentSnapshot) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (documentSnapshot.exists) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        print(&#x27;Document exists on the database&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div></div></div></div></div><p>If the document exists, you can read the data of it by calling the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot/data.html" target="_blank"><code>data</code></a>
method, which returns a <code>Map&lt;String, dynamic&gt;</code>, or <code>null</code> if it does not exist:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(userId)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((DocumentSnapshot documentSnapshot) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (documentSnapshot.exists) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        print(&#x27;Document data: ${documentSnapshot.data()}&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        print(&#x27;Document does not exist on the database&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div></div></div></div></div><p>A <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot-class.html" target="_blank"><code>DocumentSnapshot</code></a> also provides the ability to access
deeply nested data without manually iterating the returned <code>Map</code> via the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot/get.html" target="_blank"><code>get</code></a>
method. The method accepts a dot-separated path or a <span><code>FieldPath</code></span> instance.
If no data exists at the nested path, a <a href="https://api.dart.dev/stable/2.8.4/dart-core/StateError-class.html"><code>StateError</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dynamic nested = snapshot.get(FieldPath([&#x27;address&#x27;, &#x27;postcode&#x27;]));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} on StateError (e) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  print(&#x27;No nested field exists!&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="querying"></a>Querying<a aria-hidden="true" tabindex="-1" class="hash-link" href="#querying" title="Direct link to heading">#</a></h3><p>Cloud Firestore offers advanced capabilities for querying collections. Queries work with both
one-time reads or subscribing to changes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="filtering"></a>Filtering<a aria-hidden="true" tabindex="-1" class="hash-link" href="#filtering" title="Direct link to heading">#</a></h4><p>To filter documents within a collection, the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/Query/where.html" target="_blank"><code>where</code></a> method can be chained
onto a collection reference. Filtering supports equality checks and &quot;in&quot; queries. For example, for filter
users where their age is greater than 20:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .where(&#x27;age&#x27;, isGreaterThan: 20)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><p>Firestore also supports array queries. For example, to filter users who speak English (en) or Italian (it), use
the <code>arrayContainsAny</code> filter:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .where(&#x27;language&#x27;, arrayContainsAny: [&#x27;en&#x27;, &#x27;it&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><p>To learn more about all of the querying capabilities Cloud Firestore has to offer, view the
<a href="https://firebase.google.com/docs/firestore/query-data/queries" target="_blank" rel="noopener noreferrer">Firebase documentation</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="limiting"></a>Limiting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#limiting" title="Direct link to heading">#</a></h4><p>To limit the number of documents returned from a query, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/Query/limit.html" target="_blank"><code>limit</code></a> method on a collection reference:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .limit(2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><p>You can also limit to the last documents within the collection query by using <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/Query/limitToLast.html" target="_blank"><code>limitToLast</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .orderBy(&#x27;age&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .limitToLast(2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ordering"></a>Ordering<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ordering" title="Direct link to heading">#</a></h4><p>To order the documents by a specific value, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/Query/orderBy.html" target="_blank"><code>orderBy</code></a> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .orderBy(&#x27;age&#x27;, descending: true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="start--end-cursors"></a>Start &amp; End Cursors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#start--end-cursors" title="Direct link to heading">#</a></h4><p>To start and/or end a query at a specific point within a collection, you can pass a value to the <code>startAt</code>, <code>endAt</code>,
<code>startAfter</code> or <code>endBefore</code> methods. You must specify an order to use cursor queries, for example:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .orderBy(&#x27;age&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .orderBy(&#x27;company&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .startAt([20, &#x27;Swift - Harber&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .endAt([50, &#x27;Wiza Group&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><p>You can further specify a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentSnapshot-class.html" target="_blank"><code>DocumentSnapshot</code></a> instead of a specific value,
by passing it to the <code>startAfterDocument</code>, <code>startAtDocument</code>, <code>endAtDocument</code> or <code>endBeforeDocument</code> methods. For example:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .orderBy(&#x27;age&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .startAfterDocument(documentSnapshot)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .then(...);</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="query-limitations"></a>Query Limitations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#query-limitations" title="Direct link to heading">#</a></h4><p>Cloud Firestore does not support the following types of queries:</p><ul><li>Queries with range filters on different fields, as described in the previous section.</li><li>Logical OR queries. In this case, you should create a separate query for each OR condition and merge the query results
in your app.</li><li>Queries with a != clause. In this cause, you should split the query into a greater-than query and a less-than query.
For example, the query clause <code>where(&quot;age&quot;, isNotEqualTo: 30)</code> is not supported, however you can get the same result set
by combining two queries, one with the clause <code>where(&quot;age&quot;, isLessThan: 30)</code> and one with the clause
<code>where(&quot;age&quot;, isGreaterThan: 30)</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="writing-data"></a>Writing Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#writing-data" title="Direct link to heading">#</a></h2><p>The <a href="https://firebase.google.com/docs/firestore/manage-data/structure-data" target="_blank" rel="noopener noreferrer">Firebase Documentation</a> provides some great
examples on the best practices to structuring your data. It is recommended that you read the guide before building your
database.</p><p>For more information on what is possible when writing data to Firestore, please refer to
this <a href="https://firebase.google.com/docs/firestore/manage-data/add-data" target="_blank" rel="noopener noreferrer">documentation</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="adding-documents"></a>Adding Documents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-documents" title="Direct link to heading">#</a></h2><p>To add a new document to a collection, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/CollectionReference/add.html" target="_blank"><code>add</code></a> method
on a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/CollectionReference-class.html" target="_blank"><code>CollectionReference</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class AddUser extends StatelessWidget {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final String fullName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final String company;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final int age;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  AddUser(this.fullName, this.company, this.age);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Widget build(BuildContext context) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create a CollectionReference called users that references the firestore collection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Future&lt;void&gt; addUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // Call the users CollectionReference to add a new user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .add({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;full_name&#x27;: fullName, // John Doe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;company&#x27;: company, // Stokes and Sons</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;age&#x27;: age // 42</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .then((value) =&gt; print(&quot;User Added&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          .catchError((error) =&gt; print(&quot;Failed to add user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return FlatButton(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      onPressed: addUser,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      child: Text(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;Add User&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>The <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/CollectionReference/add.html" target="_blank"><code>add</code></a> method adds the new document to your collection with a
unique auto-generated ID. If you&#x27;d like to specify your own ID, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/set.html" target="_blank"><code>set</code></a>
method on a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference-class.html" target="_blank"><code>DocumentReference</code></a> instead:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; addUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .set({</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      &#x27;full_name&#x27;: &quot;Mary Jane&quot;,</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      &#x27;age&#x27;: 18</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Added&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to add user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Calling <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/set.html" target="_blank"><code>set</code></a> with a id that already exists on the collection will replace all the document data.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="updating-documents"></a>Updating documents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#updating-documents" title="Direct link to heading">#</a></h3><p>Sometimes you may wish to update a document, rather than replacing all of the data. The <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/set.html" target="_blank"><code>set</code></a>
method above replaces any existing data on a given <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference-class.html" target="_blank"><code>DocumentReference</code></a>.
If you&#x27;d like to update a document instead, use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/update.html" target="_blank"><code>update</code></a> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; updateUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .update({&#x27;company&#x27;: &#x27;Stokes and Sons&#x27;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Updated&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to update user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>The method also provides support for updating deeply nested values via dot-notation:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; updateUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .update({&#x27;info.address.zipcode&#x27;: 90210})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Updated&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to update user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="field-values"></a>Field values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#field-values" title="Direct link to heading">#</a></h4><p>Cloud Firestore supports storing and manipulating values on your database, such as Timestamps, GeoPoints, Blobs and
array management.</p><p>To store <a href="https://pub.dev/documentation/cloud_firestore_platform_interface/2.0.0-dev.1/cloud_firestore_platform_interface/GeoPoint-class.html" target="_blank"><code>GeoPoint</code></a> values, provide the latitude
and longitude to the GeoPoint class:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; updateUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .update({&#x27;info.address.location&#x27;: GeoPoint(53.483959, -2.244644)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Updated&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to update user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>To store a Blob such as an image, provide a <code>Uint8List</code>. The below example shows how to get an image from your <code>assets</code>
directory and nest it in the <code>info</code> object in Firestore.</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; updateUser() {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  return rootBundle</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .load(&#x27;assets/images/sample.jpg&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .then((bytes) =&gt; bytes.buffer.asUint8List())</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .then((avatar) {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      return users</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        .update({&#x27;info.avatar&#x27;: Blob(avatar)});</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Updated&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to update user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="removing-data"></a>Removing Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#removing-data" title="Direct link to heading">#</a></h2><p>To delete documents with Cloud Firestore, you can use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/delete.html" target="_blank"><code>delete</code></a>
method on a <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference-class.html" target="_blank"><code>DocumentReference</code></a>:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; deleteUser() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .delete()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Deleted&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to delete user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>If you need to remove specific properties from within a document rather than the document itself,
you can use the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/DocumentReference/delete.html" target="_blank"><code>delete</code></a> method with
the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FieldValue-class.html" target="_blank"><code>FieldValue</code></a> class:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; deleteField() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .doc(&#x27;ABC123&#x27;)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    .update({&#x27;age&#x27;: FieldValue.delete()})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .then((value) =&gt; print(&quot;User Deleted&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .catchError((error) =&gt; print(&quot;Failed to delete user: $error&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="transactions"></a>Transactions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#transactions" title="Direct link to heading">#</a></h2><p>Transactions are a way to ensure that a write operation only occurs using the latest data available on the server.
Transactions never partially apply writes, and writes execute at the end of a successful transaction.</p><p>Transactions are useful when you want to update a field based on its current value, or the value of another field. If
you want to write multiple documents without using the documents current state, a <a href="/docs/firestore/usage#batch-write">batch write</a>
should be used.</p><p>When using transactions, note that:</p><ul><li>Read operations must come before write operations</li><li>Transactions will fail is the client is offline, they cannot use cached data</li></ul><p>An example of where a transaction could be used would be in an application where a user can subscribe to a channel. When
a user presses the subscribe button, a &quot;subscribers&quot; field in a document increments. Without using Transactions, we would
first need to read the existing value, and then increment that value using two separate operations.</p><p>On a high traffic application, the value on the server could have already changed by the time the write operation sets
a new value, causing the number to be inconsistent.</p><p>Transactions remove this issue by atomically updating the value of the server. If the value changes whilst the transaction
is executing, it will retry, ensuring the value on the server is used, rather than the client value.</p><p>To execute a transaction, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/runTransaction.html" target="_blank"><code>runTransaction</code></a> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Create a reference to the document the transaction will use</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DocumentReference documentReference = FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .collection(&#x27;users&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .doc(documentId);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return Firestore.instance.runTransaction((transaction) async {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Get the document</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DocumentSnapshot snapshot = await transaction.get(documentReference);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (!snapshot.exists) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    throw Exception(&quot;User does not exist!&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Update the follower count based on the current count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int newFollowerCount = snapshot.data()[&#x27;followers&#x27;] + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Perform an update on the document</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  transaction.update(documentReference, {&#x27;followers&#x27;: newFollowerCount});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Return the new count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return newFollowerCount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.then((value) =&gt; print(&quot;Follower count updatd to $value&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.catchError((error) =&gt; print(&quot;Failed to update user followers: $error&quot;));</span></div></div></div></div></div><p>In the above example, if the document changes at any point during the transaction, it will retry
up-to five times.</p><p>You should not directly modify application state inside of the transaction, as the handler may execute multiple
times. You should instead return a value at the end of the handler, updating application state once the transaction
has completed.</p><p>If an exception is thrown within the handler, the entire transaction will be aborted.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="batch-write"></a>Batch write<a aria-hidden="true" tabindex="-1" class="hash-link" href="#batch-write" title="Direct link to heading">#</a></h2><p>Firestore lets you execute multiple write operations as a single batch that can contain any
combination of <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/WriteBatch/set.html" target="_blank"><code>set</code></a>, <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/WriteBatch/update.html" target="_blank"><code>update</code></a>,
or <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/WriteBatch/delete.html" target="_blank"><code>delete</code></a> operations.</p><p>First, create a new batch instance via the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/batch.html" target="_blank"><code>batch</code></a> method, then perform
the operations on the batch, and then commit it once ready. The below example shows how to delete
all documents in a collection in a single operation:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CollectionReference users = FirebaseFirestore.instance.collection(&#x27;users&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;void&gt; batchDelete() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  WriteBatch batch = FirebaseFirestore.instance.batch();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return users.get().then((querySnapshot) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    querySnapshot.documents.forEach((document) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      batch.delete(document.reference);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return batch.commit();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="data-security"></a>Data Security<a aria-hidden="true" tabindex="-1" class="hash-link" href="#data-security" title="Direct link to heading">#</a></h2><p>It is important that you understand how to write rules in your Firebase console to ensure that your data is secure.
Please follow the Firebase Firestore documentation on <a href="https://firebase.google.com/docs/firestore/security/get-started" target="_blank" rel="noopener noreferrer">security</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="access-data-offline"></a>Access Data Offline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#access-data-offline" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configure-offline-persistence"></a>Configure Offline Persistence<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-offline-persistence" title="Direct link to heading">#</a></h3><p>Firestore provides out of the box support for offline capabilities. When reading and writing data, Firestore uses a
local database which automatically synchronizes with the server. Cloud Firestore functionality continues when users are
offline, and automatically handles data migration when they regain connectivity.</p><p>This functionality is enabled by default, however it can be disabled if needed. The <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/settings.html" target="_blank"><code>settings</code></a>
method must be called before any Firestore interaction is performed:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance.settings(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Settings(persistenceEnabled: false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>If you want to clear any persisted data, you can call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/clearPersistence.html" target="_blank"><code>clearPersistence()</code></a> method.</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance.clearPersistence();</span></div></div></div></div></div><p>Calls to update settings or clearing persistence must be carried out before any other usage of
Firestore. If called afterwards, they will take effect on the next Firestore claim (e.g. restarting
the application).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configure-cache-size"></a>Configure Cache Size<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-cache-size" title="Direct link to heading">#</a></h3><p>When persistence is enabled, Firestore caches every document for offline access. After exceeding the cache size, Firestore
will attempt to remove older, unused data. You can configure different cache sizes, or disable the removal process:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// The default value is 40 MB. The threshold must be set to at least 1 MB,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// and can be set to Settings.CACHE_SIZE_UNLIMITED to disable garbage collection.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance.settings(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Settings(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cacheSizeBytes: Settings.CACHE_SIZE_UNLIMITED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ));</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="disable-and-enable-network-access"></a>Disable and Enable Network Access<a aria-hidden="true" tabindex="-1" class="hash-link" href="#disable-and-enable-network-access" title="Direct link to heading">#</a></h3><p>It is possible to disable network access for your Firestore client. While network access is disabled, all Firestore requests
retrieve results from the cache. Any write operations are queued until network access is re-enabled.</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance.disableNetwork()</span></div></div></div></div></div><p>To re-enabled network access, call the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/enableNetwork.html" target="_blank"><code>enableNetwork</code></a> method:</p><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance.enableNetwork()</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="emulator-usage"></a>Emulator Usage<a aria-hidden="true" tabindex="-1" class="hash-link" href="#emulator-usage" title="Direct link to heading">#</a></h2><p>If you are using the local <a href="https://firebase.google.com/docs/rules/emulator-setup" target="_blank" rel="noopener noreferrer">Firestore emulators</a>, then it is possible to
connect to these by passing a <span><code>host</code></span> parameter to the <a href="https://pub.dev/documentation/cloud_firestore/0.14.0-dev.1/cloud_firestore/FirebaseFirestore/settings.html" target="_blank"><code>settings</code></a> method,
immediately after initializing Firebase. Ensure you pass the correct port on which the Firebase emulator is running on.</p><blockquote class="blockquote_3DgE"><p>On Android, to reference <code>localhost</code>, use the <code>10.0.2.2</code> IP address instead.</p></blockquote><div class="mdxCodeBlock_x_oC"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Initialize first</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseCore.instance.initializeApp();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Set the host as soon as possible</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">await FirebaseFirestore.instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .settings(Settings(host: &quot;localhost:8080&quot;, sslEnabled: false));</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/FirebaseExtended/flutterfire/edit/master/docs/../docs/firestore/usage.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/firestore/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Cloud Firestore</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/functions/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cloud Functions »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#collections--documents" class="table-of-contents__link">Collections &amp; Documents</a></li><li><a href="#read-data" class="table-of-contents__link">Read Data</a><ul><li><a href="#one-time-read" class="table-of-contents__link">One-time Read</a></li><li><a href="#realtime-changes" class="table-of-contents__link">Realtime changes</a></li><li><a href="#document--query-snapshots" class="table-of-contents__link">Document &amp; Query Snapshots</a></li><li><a href="#querying" class="table-of-contents__link">Querying</a></li></ul></li><li><a href="#writing-data" class="table-of-contents__link">Writing Data</a></li><li><a href="#adding-documents" class="table-of-contents__link">Adding Documents</a><ul><li><a href="#updating-documents" class="table-of-contents__link">Updating documents</a></li></ul></li><li><a href="#removing-data" class="table-of-contents__link">Removing Data</a></li><li><a href="#transactions" class="table-of-contents__link">Transactions</a></li><li><a href="#batch-write" class="table-of-contents__link">Batch write</a></li><li><a href="#data-security" class="table-of-contents__link">Data Security</a></li><li><a href="#access-data-offline" class="table-of-contents__link">Access Data Offline</a><ul><li><a href="#configure-offline-persistence" class="table-of-contents__link">Configure Offline Persistence</a></li><li><a href="#configure-cache-size" class="table-of-contents__link">Configure Cache Size</a></li><li><a href="#disable-and-enable-network-access" class="table-of-contents__link">Disable and Enable Network Access</a></li></ul></li><li><a href="#emulator-usage" class="table-of-contents__link">Emulator Usage</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation/android">Android Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation/ios">iOS Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation/web">Web Installation</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/flutterfire" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://flutter.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flutter</a></li><li class="footer__item"><a href="https://pub.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">pub.dev</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/FirebaseExtended/flutterfire" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/flutterfiredev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div><div style="margin-top: 3rem"><small>Except as otherwise noted, this work is licensed under a Creative Commons Attribution 4.0 International License, and code samples are licensed under the BSD License.</small></div></div></div></div></footer></div>
<script src="/styles.c98d0ca8.js"></script>
<script src="/runtime~main.5b92252b.js"></script>
<script src="/main.0718b78d.js"></script>
<script src="/1.37d6b62d.js"></script>
<script src="/2.33792e98.js"></script>
<script src="/1be78505.7a3fab9e.js"></script>
<script src="/44.07295e31.js"></script>
<script src="/46.c746ba4f.js"></script>
<script src="/20ac7829.8ec54cef.js"></script>
<script src="/4ef789ca.1eae9852.js"></script>
</body>
</html>